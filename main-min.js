/*
*assinput:联想输入
*by:　   zhe-he
*e-mail:    hezhe@jiaju.com
*人有多懒，思想就有多远
*version: 1.0
*last-time:2015-7-22
*/
(function(d){function e(a,b){this.ul=b.ul?d(a).find(b.ul):d(a).find("ul").eq(0);this.hidden=b.hidden?d(a).find(b.hidden):d(a).find("input[type\x3dhidden]").eq(0);this.input=b.input?d(a).find(b.input):d(a).find("input[type\x3dtext]").eq(0);this.callback=b.callback;this.para=b.para||{};this.format=this.para.key&&this.para.value?"hard":b.format;this.data=b.data;this.keyword=b.keyword;this.ajax=b.ajax;this.re=/(?:)/;this.ready=!1;this.init()}d.tools=d.tools||{version:"1.0"};d.tools.Assinput={ul:"",hidden:"",input:"",data:"",keyword:"",ajax:{},format:"",para:{},callback:function(){}};e.prototype={constructor:e,init:function(){delete this.init;var a=this;this.input.keyup(function(){a.find.call(a)});this.input.focus(function(){a.find.call(a)});this.input.blur(function(){setTimeout(function(){a.ready||a.blur.call(a)},300)});this.ul.delegate("li","click",function(){var b=d(this).html(),c=d(this).attr("data-key");a.ready=!0;a.set.call(a,b,c)})},_ajax:function(){var a=this;this.ajax.success=function(b){a.success(b)};d.ajax(this.ajax)},success:function(a){"string"===typeof a&&d.parseJSON(a);if("string"===typeof this.data){a=this.data.split(".");for(var b="data",c=0;c<a.length;c++)b+='["'+a[c]+'"]';this.data=eval(b)}this.get()},filter:function(){var a,b=0,c=/\w+/g;if(-1!=Object.prototype.toString.call(this.data).indexOf("Array")&&0<this.data.length){if(-1!=Object.prototype.toString.call(this.data[0]).indexOf("Object")){for(a in this.data[0])b++,1===b?c.test(this.data[0][a])?this.para.key=a:this.para.value=a:this.para.key?this.para.value=a:this.para.key=a;this.format=1===b?"normal":"hard"}}else if(-1!=Object.prototype.toString.call(this.data).indexOf("Object"))this.format="easy";else throw this.format="unknow","\u5f53\u524d\u683c\u5f0f\u65e0\u6cd5\u89e3\u6790";},find:function(){var a=this.input.val();this.ajax?(this.ajax.data[this.keyword]=a,this._ajax()):(this.re=RegExp(a),this.get())},blur:function(a){a=this.ul.children();var b="",c="";a.length&&this.input.val()&&(b=a.eq(0).html(),c=a.eq(0).attr("data-key"));this.set(b,c)},get:function(){!this.format&&this.filter();this.ul.css("display","none");this.ul.empty();if("easy"===this.format)for(var a in this.data){if(this.ajax||this.re.test(this.data[a])||this.re.test(a)){var b=["\x3cli data-key\x3d",a,"\x3e",this.data[a],"\x3c/li\x3e"],b=b.join("");this.ul.append(b).css("display","block")}}else if("normal"===this.format)for(var c=0;c<this.data.length;c++)for(a in this.data[c]){if(this.ajax||this.re.test(this.data[c][a])||this.re.test(a))b=["\x3cli data-key\x3d",a,"\x3e",this.data[c][a],"\x3c/li\x3e"],b=b.join(""),this.ul.append(b).css("display","block")}else if("hard"===this.format)for(c=0;c<this.data.length;c++)if(this.ajax||this.re.test(this.data[c][this.para.key])||this.re.test(this.data[c][this.para.value]))b=["\x3cli data-key\x3d",this.data[c][this.para.key],"\x3e",this.data[c][this.para.value],"\x3c/li\x3e"],b=b.join(""),this.ul.append(b).css("display","block")},set:function(a,b){var c=this;this.input.val(a);this.hidden.val(b);this.ul.css("display","none");this.callback&&this.callback(a,b);c.ready&&setTimeout(function(){c.ready=!1},300)}};d.fn.Assinput=function(a){return this.each(function(b,c){d(this).data("Assinput",new e(c,a))})}})(jQuery);